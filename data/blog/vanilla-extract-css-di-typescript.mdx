---
title: 'Vanilla Extract: Nulis CSS di TypeScript'
summary: 'Paket lengkap solusi styling buat yang bosen sama tool yang itu-itu aja.'
publishedAt: 2022-07-30
cover: vanilla-extract.png
---

Vanilla Extract memiliki pondasi yang kuat sebagai solusi styling, tool ini memposisikan dirinya sebagai CSS preprocessor layaknya SASS; Hanya saja menggunakan JavaScript/Typescript sebagai "compiler"-nya.

Dikutip dari website resminya:

> Use TypeScript as your preprocessor. Write type-safe, locally scoped classes, variables and themes, then generate static CSS files at build time.
>
> <cite>~[Vanilla Extract](https://vanilla-extract.style)</cite>

Saya bukan termasuk orang yang mengagungkan CSS in JS pada umumnya. Tapi kali ini saya _hype-banget_ sama tool satu ini, terutama karena fitur _static extraction_; yap, tool ini tidak<span style={{ fontSize: '.65em', fontStyle: 'italic', verticalAlign: 'text-top' }}>\*</span> menggunakan runtime pada penerapan style-nya.

## Zero-runtime

CSS in JS banyak dipilih salah satu alasannya karena _developer-experience_ yang diberikan dapat meningkatkan produktifitas si developer. Namun tak jarang malah mengorbankan performance website yang dibuat karena browser client harus parse styles dengan JavaScript.

Meskipun Vanilla Extract bisa dikategorikan CSS in JS, tool ini tidak menambah bundle JavaScript karena semua styles di extract waktu build menjadi file CSS sehingga performance menjadi kelebihan Vanilla Extract, semua tanpa mengorbankan DX yang didapatkan di CSS in JS lain.

<Tab>
  <Tab.Item title="Button.css.ts">

```ts {0-99}
import { style } from '@vanilla-extract/css'

const styles = {
  button: style({
    padding: '0.5rem 1.5rem',
    fontWeight: '500',
    color: 'white',
    backgroundColor: 'rebeccapurple',
    borderRadius: '9999px',
    ':hover': {
      backgroundColor: 'blueviolet'
    }
  })
}

export default styles
```

  </Tab.Item>
  <Tab.Item title="Button.tsx">

```tsx {0-99}
import styles from './Button.css.ts'

const Button = () => {
  return <button className={styles.button}>Button</button>
}

export default Button
```

  </Tab.Item>
</Tab>

Kode tersebut akan di proses oleh Vanilla Extract menjadi:

<Tab>
  <Tab.Item title="button.css">

```css {0-99}
._1qaee7u0 {
  padding: 0.5rem 1.5rem;
  font-weight: 500;
  color: #fff;
  background-color: #639;
  border-radius: 9999px;
}
._1qaee7u0:hover {
  background-color: #8a2be2;
}
```

  </Tab.Item>
  <Tab.Item title="button.html">

```html {0-99}
<button class="_1qaee7u0">Button</button>
```

  </Tab.Item>
</Tab>

### Preview

<VanillaExtract.ZeroRuntimeButton />

_<small>^coba inspect button ini di devtool ehehe</small>_

Karena output dari Vanilla Extract berupa vanilla CSS, kita bisa proses lebih lanjut dengan PostCSS, misal untuk polyfill browser lama, pakai syntax experimental, atau sekadar autoprefix, dsb.

<Callout type="info">
  Buat yang notice value _backgroundColor_ yang tadinya `rebeccapurple` berubah
  ke hex `#639`, itu adalah salah satu kegunaan PostCSS.
  <br />
  [cssdb.org/#rebeccapurple-color](https://cssdb.org/#rebeccapurple-color)
</Callout>

Namun ada beberapa _optional_ API Vanilla Extract yang membutuhkan runtime minimal seperti:

- [Recipes API](https://vanilla-extract.style/documentation/recipes-api) untuk toggles prebuilt classes berdasarkan variant props; dan
- [Dynamic API](https://vanilla-extract.style/documentation/dynamic-api) untuk override css variable secara dinamis.

Selain karena _zero-runtime_, Vanilla Extract memiliki API yang memudahkan kita untuk menerapkan Atomic CSS.

## Utility-first Atomic Styling

via [Sprinkles API](https://vanilla-extract.style/documentation/sprinkles-api);

> Basically, it's like building your own zero-runtime, type-safe version of Tailwind, Styled System, etc.

Sebelumnya saya pernah menggunakan TailwindCSS dimana setiap class hanya memiliki satu fungsi: _"Do one thing, and do it really well."_

Dengan begitu bundle CSS bisa menjadi sangat kecil karena <s>sizenya pindah ke markup HTML aowskaosk</s> tiap class sangat reusable.

Mari buat sprinkles lalu menggunakannya ke _stylesheets_ button kita tadi..

<Tab>
  <Tab.Item title="sprinkles.css.ts">

```ts {0-99}
import { defineProperties, createSprinkles } from '@vanilla-extract/sprinkles'

const borderRadius = {
  sm: '0.25rem',
  md: '0.375rem',
  lg: '0.5rem',
  full: '9999px'
}

const properties = defineProperties({
  properties: {
    color: ['white']
  }
})

const interactiveProperties = defineProperties({
  defaultCondition: 'idle',
  conditions: {
    idle: {},
    hover: { selector: '&:hover' }
  },
  properties: {
    backgroundColor: ['rebeccapurple', 'blueviolet'],
    borderRadius
  }
})

export default createSprinkles(properties, interactiveProperties)
```

  </Tab.Item>
  <Tab.Item title="Button.css.ts">

```ts {0-99}
import { style } from '@vanilla-extract/css'
import sprinkles from './sprinkles.css'

const styles = {
  button: style([
    {
      padding: '0.5rem 1.5rem',
      fontWeight: '500'
    },
    sprinkles({
      color: 'white',
      borderRadius: 'full',
      backgroundColor: {
        idle: 'rebeccapurple',
        hover: 'blueviolet'
      }
    })
  ])
}

export default styles
```

  </Tab.Item>
</Tab>

output:

<Tab>
  <Tab.Item title="button.css">

```css {0-12,25-33} showLineNumbers
/* sprinkles start */
._7mhif20 {
  color: #fff;
}
._7mhif21,
._7mhif22:hover {
  background-color: #639;
}
._7mhif23,
._7mhif24:hover {
  background-color: #8a2be2;
}
._7mhif25,
._7mhif26:hover {
  border-radius: 0.25rem;
}
._7mhif27,
._7mhif28:hover {
  border-radius: 0.375rem;
}
._7mhif2a:hover,
._7mhif29 {
  border-radius: 0.5rem;
}
._7mhif2b,
._7mhif2c:hover {
  border-radius: 9999px;
}
/* sprinkles end */
.jwmujm1 {
  padding: 0.5rem 1.5rem;
  font-weight: 500;
}
```

  </Tab.Item>
  <Tab.Item title="button.html">

```html {0-99}
<button class="jwmujm1 _7mhif20 _7mhif2b _7mhif21 _7mhif24">
  Sprinkles Button
</button>
```

  </Tab.Item>
</Tab>

Bisa dilihat bahwa semua properties di sprinkles akan digenerate oleh Vanilla Extract baik yang digunakan maupun tidak. Hal ini karena sprinkles dapat juga digunakan di client runtime dengan menggunakannya langsung di component kita _(bukan file .css.ts)_, jadi semua _possible-styles_ di sprinkles harus tersedia.

Dari core contributor Vanilla Extract:
_"... We like to use Sprinkles for the most common 80% of your styles. ..."_
[@mattcompiles](https://github.com/mattcompiles) di [GitHub Discussion](https://github.com/seek-oss/vanilla-extract/discussions/421#discussioncomment-1501542)

Jadi sprinkles akan efektif ketika style memang digunakan di banyak components, kita harus pandai-pandai mengaturnya. Mari kita hilangkan _borderRadius_ dari sprinkles.

<Tab>
  <Tab.Item title="sprinkles.css.ts">

```diff {3-8,24} showLineNumbers
import { defineProperties, createSprinkles } from '@vanilla-extract/sprinkles'

-const borderRadius = {
-  sm: '0.25rem',
-  md: '0.375rem',
-  lg: '0.5rem',
-  full: '9999px'
-}

const properties = defineProperties({
  properties: {
    color: ['white']
  }
})

const interactiveProperties = defineProperties({
  defaultCondition: 'idle',
  conditions: {
    idle: {},
    hover: { selector: '&:hover' }
  },
  properties: {
    backgroundColor: ['rebeccapurple', 'blueviolet'],
-   borderRadius
  }
})

export default createSprinkles(properties, interactiveProperties)
```

  </Tab.Item>
  <Tab.Item title="Button.css.ts">

```diff {9,13} showLineNumbers
import { style } from '@vanilla-extract/css'
import sprinkles from './sprinkles.css'

const styles = {
  button: style([
    {
      padding: '0.5rem 1.5rem',
      fontWeight: '500',
+     borderRadius: '9999px',
    },
    sprinkles({
      color: 'white',
-     borderRadius: 'full',
      backgroundColor: {
        idle: 'rebeccapurple',
        hover: 'blueviolet'
      }
    })
  ])
}

export default styles
```

  </Tab.Item>
</Tab>

Output setelahnya:

<Tab>
  <Tab.Item title="button.css">

```css {0-99} showLineNumbers
/* sprinkles start */
._7mhif20 {
  color: #fff;
}
._7mhif21,
._7mhif22:hover {
  background-color: #639;
}
._7mhif23,
._7mhif24:hover {
  background-color: #8a2be2;
}
/* sprinkles end */
.jwmujm1 {
  padding: 0.5rem 1.5rem;
  font-weight: 500;
  border-radius: 9999px;
}
```

  </Tab.Item>
  <Tab.Item title="button.html">

```html {0-99}
<button class="jwmujm1 _7mhif20 _7mhif21 _7mhif24">Sprinkles Button</button>
```

  </Tab.Item>
</Tab>

### Preview

<VanillaExtract.SprinklesButton />

Memang membandingkan tool ini dengan framework seperti Tailwind ngga _apple-to-apple_ karena tujuan mereka sudah berbeda, tapi bagaimanapun Vanilla Extract memiliki kelebihan:

- **Minimal abstraction over standard CSS**, ngga usah nge-hafalin class seperti Tailwind. Jujur, ketika pakai Tailwind saya harus selalu buka docs mereka. Buat developer yang "paham" CSS, saya yakin ini jadi salah satu _obstacle_.
- **Free ClassName Obfuscation**, karena output class yang dihasilkan berupa _hash_, ini akan menjadi nilai plus untuk developer yang menginginkan pekerjaanya tidak mudah di-clone.
- **Type-safe**, kalau style dihapus dari sprinkles namun masih menjadi _dependency_ di sebuah component, build akan fail. Refactoring kode juga lebih percaya diri.

## Multi-variant Styles

Sebelumnya website ini dibangun dengan [Stitches](https://stitches.dev), sebuah CSS in JS dengan _near-zero_ runtime; saya tertarik karena [Variants API](https://stitches.dev/docs/variants) mereka yang sangat memudahkan styling components.

Hingga saya putuskan untuk [migrate sepenuhnya](https://github.com/bwyx/bayukurnia.com/pull/22) ke Vanilla Extract, karena Vanilla Extract juga release Variants API versi mereka: [Recipes API](https://vanilla-extract.style/documentation/recipes-api/);

> Create multi-variant styles with a type-safe runtime API, heavily inspired by Stitches.

Recipes API memudahkan developer dalam membangun component library, semua variasi styles bisa dijadikan satu definisi saja.

```ts {0-99}
// Button.css.ts

import { recipe } from '@vanilla-extract/recipes'

const button = recipe({
  base: {
    // style yang dimiliki oleh semua variants
  },
  variants: {
    rounded: {
      // nama variant dapat berupa boolean
      true: {...}
    },
    color: {
      pink: {...},
      gray: {...},
    }
  },
  compoundVariants: [
    // style ketika dua variant atau lebih yang aktif secara bersamaan
  ],
  defaultVariants: {
    rounded: false,
    color: 'pink'
  }
})

export default { button }
```

### Button Variants

<VanillaExtract.VariantsButton children="Button" color="pink" />
<VanillaExtract.VariantsButton children="Button" color="pink" rounded />
<VanillaExtract.VariantsButton children="Button" color="gray" />
<VanillaExtract.VariantsButton children="Button" color="gray" rounded />

<br />
<br />

<Tab>
  <Tab.Item title="ButtonVariants.tsx">

```markup {0-99}
<Button color="pink">Button</Button>
<Button rounded>Button</Button>
<Button color="gray">Button</Button>
<Button color="gray" rounded>Button</Button>
```

  </Tab.Item>
  <Tab.Item title="Button.tsx">

```tsx {0-99}
import { RecipeVariants } from '@vanilla-extract/recipes'

import button from './Button.css.ts'

function Button({ color, rounded }: RecipeVariants<typeof button>) {
  return <button className={button({ color, rounded })}>Button</button>
}
```

  </Tab.Item>
</Tab>

Dan Recipes API ini bisa dikombinasikan dengan [Sprinkles API](https://vanilla-extract.style/documentation/sprinkles-api), sehingga kita bisa re-use atomic styles yang sudah ada untuk compose variants.. mantab..

Berikut sebuah component Button dengan:

- 3 variant: `contained`, `outlined`, `text` - <small>default</small>
- 3 size: `small`, `normal` - <small>default</small>, `large`
- 2 color: `pink` - <small>default</small>, `gray`
- 2 boolean state: `loading`, `disabled`
- 9 rounded variant: `false` - <small>default</small>, `true` - <small>full rounded</small>, `xs`, `sm`, `md`, `lg`, `xl`, `2xl`, `3xl`

<VanillaExtract.Buttons />

## Akhiran

Vanilla Extract mempunyai segudang fitur modern yang tidak dapat didapatkan di old-school CSS tooling karena penggunaan ekosistem TypeScript nya. Beragam API yang disediakan sangat menunjang produktifitas para developer menjadikan tool ini dapat menggantikan berbagai tool sekaligus.

Banyak fitur dan manfaat lain dari Vanilla Extract yang tidak saya tulis, saya cantumkan beberapa referensi terkait tool ini di bawah.

Terimakasih.

---

- [andreipfeiffer/css-in-js](https://github.com/andreipfeiffer/css-in-js)
- [vanilla-extract.style](!https://vanilla-extract.style)
- [CSS Tricks: CSS in TypeScript with vanilla-extract](https://css-tricks.com/css-in-typescript-with-vanilla-extract)
- [Mark's talk on vanilla-extract](https://www.youtube.com/watch?v=23VqED_kO2Q&t=365s)
