---
export const prerender = true

import { format } from 'date-fns'
import { getCollection } from 'astro:content'

import MainLayout from '~/layouts/Main.layout.astro'
import Header, { headerStyles } from '~/components/blog/Header/Header.astro'
import Footer from '~/components/Footer/Footer.astro'

import { prose } from '~/components/Article/Article.css'
import styles from '~/styles/pages/blogPost.css'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post }
  }))
}

const { post } = Astro.props
const { Content } = await post.render()

const { title, publishedAt } = post.data
---

<MainLayout title={title}>
  <Header title={title}>
    <time class={headerStyles.description} datetime={publishedAt.toISOString()}>
      {format(publishedAt, 'LLLL d, yyyy')}
    </time>
  </Header>
  <article class:list={[prose, styles.article]}>
    <Content />
  </article>
  <Footer />
</MainLayout>
